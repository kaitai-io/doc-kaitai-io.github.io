<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Kaitai Project">
<title>Developers memo</title>
<link rel="stylesheet" href="styles/pygments-default.css">
<link rel="stylesheet" href="styles/bootstrap.min.css">
<link rel="stylesheet" href="styles/bootstrap-theme.min.css">
<link rel="stylesheet" href="styles/main.css">
<link rel="stylesheet" href="styles/pygments-default.css">
<link rel="stylesheet" href="./styles/colony.css">
<link rel="stylesheet" href="styles/asciidoctor-tabs.css">
</head>
<body class="article toc2 toc-left">
    <nav class="navbar navbar-inverse navbar-fixed-top" id="main-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Kaitai Struct</span>
            </div>
            <div class="collapse navbar-collapse" id="main-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class=""><a href="//kaitai.io/#what-is-it">What is it?</a></li>
                    <li class=""><a href="//kaitai.io/#quick-start">Quick Start</a></li>
                    <li class=""><a href="//kaitai.io/#download">Download</a></li>
                    <li class=""><a href="//kaitai.io/news/">News</a></li>
                    <li class=""><a href="//formats.kaitai.io/">Format Gallery</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://ide.kaitai.io/">Try it &mdash; Web IDE</a></li>
                    <li class="active"><a href="index.html">Documentation</a></li>
                </ul>
            </div>
        </div>
    </nav>
<div id="header">
<h1>Developers memo</h1>
<div class="details">
<span id="author" class="author">Kaitai Project</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_compiler">Compiler</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_configuring_proxy">Configuring proxy</a></li>
<li><a href="#_building_for_jvm">Building for JVM</a></li>
<li><a href="#_building_for_javascript_platform">Building for JavaScript platform</a></li>
<li><a href="#_publishing_a_new_version">Publishing a new version</a></li>
<li><a href="#_publishing_new_version_to_oss_sonatype_org">Publishing new version to oss.sonatype.org</a></li>
</ul>
</li>
<li><a href="#_tests">Tests</a></li>
<li><a href="#_publishing_runtime_libraries">Publishing runtime libraries</a>
<ul class="sectlevel2">
<li><a href="#java">Java</a></li>
<li><a href="#_javascript">JavaScript</a></li>
<li><a href="#_python">Python</a></li>
<li><a href="#_ruby">Ruby</a></li>
<li><a href="#csharp">C#</a></li>
</ul>
</li>
<li><a href="#_adding_new_language">Adding new language</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>KS project consists of several subprojects, each of which has its own
repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kaitai-io/kaitai_struct_compiler">compiler</a> —
everything starts here, this is the core of the project that
everything uses</p>
</li>
<li>
<p><a href="https://github.com/kaitai-io/kaitai_struct_tests">tests</a> — used to
prove that compiler behaves as expected and there are no regressions
introduced by the changes</p>
</li>
<li>
<p><a href="https://github.com/kaitai-io/kaitai_struct/tree/master/runtime">runtimes</a>,
one per each target language — used by the code generated by a
compiler</p>
</li>
<li>
<p><a href="https://github.com/kaitai-io/kaitai_struct_doc">documentation</a> —
keeps users informed about the language and all new features</p>
</li>
<li>
<p><a href="https://github.com/kaitai-io/kaitai_struct_visualizer">console
visualizer and tools: ksv, ksdump</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Technically, one can download and work with each of these subprojects
individually, but most people just download everything by checking out
<a href="https://github.com/kaitai-io/kaitai_struct">our main umbrella project</a> that
includes (almost) everything:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="shell"><span></span>git<span class="tok-w"> </span>clone<span class="tok-w"> </span>--recursive<span class="tok-w"> </span>https://github.com/kaitai-io/kaitai_struct.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>--recursive</code> option, which would download all the
submodules. If you forgot it and cloned without it, you can still do
it manually after cloning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="shell"><span></span>git<span class="tok-w"> </span>submodule<span class="tok-w"> </span>update<span class="tok-w"> </span>--init<span class="tok-w"> </span>--recursive</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compiler">Compiler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>KS compiler is written in <a href="https://www.scala-lang.org/">Scala language</a>
and thus uses <a href="https://www.scala-sbt.org/">SBT</a> for building. It can be
compiled in one of 2 ways, each of which can be packaged in one of
several ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>generating Java <code>.class</code> files, to be run in JVM</p>
<div class="ulist">
<ul>
<li>
<p>not packaged, ready to be ran from a build dir (so called "stage
build")</p>
</li>
<li>
<p>packaged as universal (.zip) package</p>
</li>
<li>
<p>packaged as Debian (.deb) package</p>
</li>
<li>
<p>packaged as Windows (.msi) installer package</p>
</li>
</ul>
</div>
</li>
<li>
<p>generating JavaScript <code>.js</code> file, to be run either inside a browser
or in node.js environment</p>
<div class="ulist">
<ul>
<li>
<p>not packaged, used as a source JS file on a website</p>
</li>
<li>
<p>packaged as <a href="https://www.npmjs.com/">npm</a> package</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>To build the compiler, one generally needs just these two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java Runtime Environment (JRE)</p>
</li>
<li>
<p>Scala Build Tool (sbt)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Debian/Ubuntu, this should be enough to download every
prerequisite (JRE is pulled automatically by sbt):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="shell"><span></span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">&quot;deb https://repo.scala-sbt.org/scalasbt/debian all main&quot;</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>sudo<span class="tok-w"> </span>tee<span class="tok-w"> </span>/etc/apt/sources.list.d/sbt.list
<span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">&quot;deb https://repo.scala-sbt.org/scalasbt/debian /&quot;</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>sudo<span class="tok-w"> </span>tee<span class="tok-w"> </span>/etc/apt/sources.list.d/sbt_old.list
curl<span class="tok-w"> </span>-sL<span class="tok-w"> </span><span class="tok-s2">&quot;https://keyserver.ubuntu.com/pks/lookup?op=get&amp;search=0x2EE0EA64E40A89B84B2DF73499E82A75642AC823&quot;</span><span class="tok-w"> </span><span class="tok-p">|</span><span class="tok-w"> </span>sudo<span class="tok-w"> </span>apt-key<span class="tok-w"> </span>add
sudo<span class="tok-w"> </span>apt-get<span class="tok-w"> </span>update
sudo<span class="tok-w"> </span>apt-get<span class="tok-w"> </span>install<span class="tok-w"> </span>sbt</code></pre>
</div>
</div>
<div class="paragraph">
<p>For RedHat-based systems, use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="shell"><span></span>curl<span class="tok-w"> </span>-L<span class="tok-w"> </span>https://www.scala-sbt.org/sbt-rpm.repo<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>sbt-rpm.repo
sudo<span class="tok-w"> </span>mv<span class="tok-w"> </span>sbt-rpm.repo<span class="tok-w"> </span>/etc/yum.repos.d/
sudo<span class="tok-w"> </span>yum<span class="tok-w"> </span>install<span class="tok-w"> </span>sbt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Manual installation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.java.com/en/download/">Download JRE from official site</a></p>
</li>
<li>
<p><a href="https://www.scala-sbt.org/download.html">Download sbt from official site</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You don&#8217;t need whole Java Development Kit (JDK), unless you want
to test &amp; develop for Java target — just JRE is enough for KS
compiler.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All other dependencies (including Scala runtimes, compilers, etc)
required for <strong>the compiler</strong> are downloaded and installed by sbt
automatically. It shouldn&#8217;t really matter even which version of sbt
you use for bootstrap, as sbt will pull relevant sbt update packages
automatically as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_proxy">Configuring proxy</h3>
<div class="paragraph">
<p>Note, that if you behind proxy, you need to run <code>sbt</code> with flags</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>  -Dhttp.proxyHost=&lt;your proxy server&gt;
  -Dhttp.proxyPort=&lt;your proxy server port&gt;
  -Dhttps.proxyHost=&lt;your proxy server&gt;
  -Dhttps.proxyPort=&lt;your proxy server port&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="shell"><span></span><span class="tok-w">  </span>sbt<span class="tok-w"> </span>-Dhttp.proxyHost<span class="tok-o">=</span>proxy.com<span class="tok-w"> </span>-Dhttp.proxyPort<span class="tok-o">=</span><span class="tok-m">3128</span><span class="tok-w"> </span>-Dhttps.proxyHost<span class="tok-o">=</span>proxy.com<span class="tok-w"> </span>-Dhttps.proxyPort<span class="tok-o">=</span><span class="tok-m">3128</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, <code>sbt</code> doesn&#8217;t understand <code>http(s)_proxy</code> environment variable properly, if it contains
address of proxy server in <code>host:port</code> format, so flags is necessary.</p>
</div>
<div class="paragraph">
<p>This flags needed only on first run or when you want to check and upgrade dependencies. After first <code>sbt</code>
run all dependencies will be downloaded and access to the internet not required anymore.</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_for_jvm">Building for JVM</h3>
<div class="paragraph">
<p>We use <a href="https://www.scala-sbt.org/sbt-native-packager/">sbt-native-packager</a> to
build deployable formats. Note that in order to perform the following builds,
one must be in the <code>kaitai_struct/compiler</code> directory.</p>
</div>
<div class="sect3">
<h4 id="_building_an_universal_zip_package">Building an universal (.zip) package</h4>
<div class="paragraph">
<p><a href="https://www.scala-sbt.org/sbt-native-packager/formats/universal.html">SBT native packager: universal package docs</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>sbt compilerJVM/universal:packageBin</code></p>
</li>
<li>
<p>Get result in <code>jvm/target/universal/kaitai-struct-compiler-*.zip</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_building_debian_package">Building <a href="https://www.scala-sbt.org/sbt-native-packager/formats/debian.html">Debian package</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install prerequisites:</p>
<div class="ulist">
<ul>
<li>
<p>On Debian/Ubuntu host: <code>sudo -i apt-get install dpkg dpkg-sig dpkg-dev lintian fakeroot</code></p>
</li>
<li>
<p>On RedHat host: <code>sudo dnf install dpkg fakeroot</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>sbt compilerJVM/debian:packageBin</code></p>
</li>
<li>
<p>Get result in <code>jvm/target/kaitai-struct-compiler_*_all.deb</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_building_redhat_package">Building <a href="https://www.scala-sbt.org/sbt-native-packager/formats/rpm.html">RedHat package</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install prerequisites:</p>
<div class="ulist">
<ul>
<li>
<p>On RedHat host: <code>sudo dnf install rpm rpm-build</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>sbt compilerJVM/rpm:packageBin</code></p>
</li>
<li>
<p>Get result in <code>jvm/target/rpm/RPMS/noarch/kaitai-struct-compiler-*.noarch.rpm</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_building_windows_package">Building Windows package</h4>
<div class="paragraph">
<p><a href="https://www.scala-sbt.org/sbt-native-packager/formats/windows.html">SBT native packager: Windows package docs</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install WIX</p>
</li>
<li>
<p><code>sbt compilerJVM/windows:packageBin</code></p>
</li>
<li>
<p>Get result in <code>jvm/target/windows/kaitai-struct-compiler.msi</code></p>
</li>
<li>
<p>Rename to add version to <code>kaitai-struct-compiler-$VERSION.msi</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_building_for_javascript_platform">Building for JavaScript platform</h3>
<div class="paragraph">
<p>Building to JavaScript platform is done using a Scala.js project. Note
that it uses a somewhat different set of dependencies, as they must
actually be JavaScript libraries, not Java jars.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run <code>sbt fastOptJS</code></p>
</li>
<li>
<p>Get result in <code>js/target/scala-2.11/kaitai-struct-compiler-fastopt.js</code></p>
</li>
<li>
<p>Use this JavaScript file on a website</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_a_new_version">Publishing a new version</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Choose a new version number (WIX imposes harsh requirements for
version to look like <code>x.x.x.x</code>) and update it in <code>build.sbt</code>,
<code>version := &#8230;&#8203;</code>, commit</p>
</li>
<li>
<p>Prepare an entry in RELEASE_NOTES.md, commit</p>
</li>
<li>
<p>Create version tag:</p>
<div class="ulist">
<ul>
<li>
<p><code>git tag $VERSION</code></p>
</li>
<li>
<p><code>git push --tags</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Update <a href="https://github.com/kaitai-io/kaitai_struct">main repository</a></p>
</li>
<li>
<p>Create new version at:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://bintray.com/kaitai-io/debian/kaitai-struct-compiler/new/version" class="bare">https://bintray.com/kaitai-io/debian/kaitai-struct-compiler/new/version</a></p>
</li>
<li>
<p><a href="https://bintray.com/kaitai-io/universal/kaitai-struct-compiler/new/version" class="bare">https://bintray.com/kaitai-io/universal/kaitai-struct-compiler/new/version</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Upload:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://bintray.com/kaitai-io/debian/kaitai-struct-compiler/$VERSION/upload" class="bare">https://bintray.com/kaitai-io/debian/kaitai-struct-compiler/$VERSION/upload</a></p>
<div class="ulist">
<ul>
<li>
<p>Debian distribution: <code>jessie</code></p>
</li>
<li>
<p>Debian component: <code>main</code></p>
</li>
<li>
<p>Debian architecture: <code>all</code></p>
</li>
<li>
<p>Attached file: <code>jvm/target/kaitai-struct-compiler_*_all.deb</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://bintray.com/kaitai-io/universal/kaitai-struct-compiler/$VERSION/upload" class="bare">https://bintray.com/kaitai-io/universal/kaitai-struct-compiler/$VERSION/upload</a></p>
<div class="ulist">
<ul>
<li>
<p>Target path: <code>$VERSION</code></p>
</li>
<li>
<p>Attached file: <code>jvm/target/universal/kaitai-struct-compiler-*.zip</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://bintray.com/kaitai-io/universal/kaitai-struct-compiler/$VERSION/upload" class="bare">https://bintray.com/kaitai-io/universal/kaitai-struct-compiler/$VERSION/upload</a></p>
<div class="ulist">
<ul>
<li>
<p>Target path: <code>$VERSION</code></p>
</li>
<li>
<p>Attached file: <code>jvm/target/windows/kaitai-struct-compiler-*.msi</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Publish them all</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_new_version_to_oss_sonatype_org">Publishing new version to oss.sonatype.org</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that one has OSS Sonatype login/password for <code>iokaitai</code> org.</p>
</li>
<li>
<p>Preliminary setup (needs to be done once per machine — verified for
sbt 1.1)</p>
<div class="ulist">
<ul>
<li>
<p>Enable the sbt-pgp plugin globally by adding this line to <code>~/.sbt/1.0/plugins/gpg.sbt</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="scala"><span></span><span class="tok-n">addSbtPlugin</span><span class="tok-p">(</span><span class="tok-s">&quot;com.github.sbt&quot;</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-s">&quot;sbt-pgp&quot;</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-s">&quot;2.1.2&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</li>
<li>
<p>Set up credentials: create <code>$HOME/.sbt/.credentials</code> with the
following contents (replacing XXX with username and password):</p>
<div class="literalblock">
<div class="content">
<pre>realm=Sonatype Nexus Repository Manager
host=oss.sonatype.org
user=XXX
password=XXX</pre>
</div>
</div>
</li>
<li>
<p>Set up <code>$HOME/.sbt/1.0/plugins/credentials.sbt</code> with the following
contents:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="scala"><span></span><span class="tok-n">credentials</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-nc">Credentials</span><span class="tok-p">(</span><span class="tok-nc">Path</span><span class="tok-p">.</span><span class="tok-n">userHome</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-s">&quot;.sbt&quot;</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-s">&quot;.credentials&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</li>
<li>
<p>For publishing the Java runtime library: set up <code>~/.m2/settings.xml</code> with the following contents:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;settings&gt;</span>
<span class="tok-w">  </span><span class="tok-nt">&lt;servers&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;server&gt;</span>
<span class="tok-w">      </span><span class="tok-nt">&lt;id&gt;</span>ossrh<span class="tok-nt">&lt;/id&gt;</span>
<span class="tok-w">      </span><span class="tok-nt">&lt;username&gt;</span>XXX<span class="tok-nt">&lt;/username&gt;</span>
<span class="tok-w">      </span><span class="tok-nt">&lt;password&gt;</span>XXX<span class="tok-nt">&lt;/password&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;/server&gt;</span>
<span class="tok-w">  </span><span class="tok-nt">&lt;/servers&gt;</span>
<span class="tok-nt">&lt;/settings&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Make sure GPG keys are present</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>sbt publishSigned</code></p>
</li>
<li>
<p>Go to <a href="https://oss.sonatype.org/#stagingRepositories" class="bare">https://oss.sonatype.org/#stagingRepositories</a></p>
</li>
<li>
<p>Continue to follow <a href="#java">Java runtime publishing instructions</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tests">Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing_runtime_libraries">Publishing runtime libraries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="java">Java</h3>
<div class="ulist">
<ul>
<li>
<p>Pump version, set version to <code>$VERSION</code>, without <code>-SNAPSHOT</code></p>
</li>
<li>
<p><code>mvn deploy</code></p>
</li>
<li>
<p>Go to <a href="https://oss.sonatype.org/#stagingRepositories" class="bare">https://oss.sonatype.org/#stagingRepositories</a></p>
</li>
<li>
<p>Scroll to the very end of list, seek <code>iokaitai-&#8230;&#8203;</code> repositories</p>
</li>
<li>
<p>Select our staging repository</p>
</li>
<li>
<p>Press "Close" toolbar button</p>
<div class="ulist">
<ul>
<li>
<p>Confirm</p>
</li>
<li>
<p>Wait for checks to complete</p>
</li>
</ul>
</div>
</li>
<li>
<p>Press "Release" toolbar button</p>
<div class="ulist">
<ul>
<li>
<p>Enter release message</p>
</li>
<li>
<p>Confirm</p>
</li>
</ul>
</div>
</li>
<li>
<p>After some time, check <a href="https://search.maven.org/#search%7Cga%7C1%7Ca%3A%22kaitai-struct-runtime%22" class="bare">https://search.maven.org/#search%7Cga%7C1%7Ca%3A%22kaitai-struct-runtime%22</a> to have new version</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_javascript">JavaScript</h3>
<div class="ulist">
<ul>
<li>
<p>First, release a <code>*-SNAPSHOT.{N}</code> version (e.g. <code>0.11.0-SNAPSHOT.4</code>)</p>
<div class="ulist">
<ul>
<li>
<p><code>npm version 0.{XXX}.0-SNAPSHOT.{YYY}</code> (will automatically commit the necessary changes and tag them accordingly)</p>
</li>
<li>
<p><code>git push origin master v0.{XXX}.0-SNAPSHOT.{YYY}</code></p>
</li>
<li>
<p>Check <a href="https://www.npmjs.com/package/kaitai-struct?activeTab=versions" class="bare">https://www.npmjs.com/package/kaitai-struct?activeTab=versions</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>If it looks good, proceed to the actual stable release</p>
<div class="ulist">
<ul>
<li>
<p><code>npm version 0.{XXX}.0</code></p>
</li>
<li>
<p><code>git push origin master v0.{XXX}.0</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_python">Python</h3>
<div class="ulist">
<ul>
<li>
<p>First, release a development version <code>0.[0-9]&#43;.dev[0-9]&#43;</code> (e.g. <code>0.11.dev4</code>):</p>
<div class="ulist">
<ul>
<li>
<p>Pump version in <code>kaitaistruct.py</code> to <code>__version__ = '0.{XXX}.dev{YYY}'</code></p>
</li>
<li>
<p><code>git tag v0.{XXX}.dev{YYY}</code></p>
</li>
<li>
<p><code>git push origin master v0.{XXX}.dev{YYY}</code></p>
</li>
<li>
<p>Check <a href="https://test.pypi.org/project/kaitaistruct/" class="bare">https://test.pypi.org/project/kaitaistruct/</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>If it looks good, proceed to the actual stable release <code>0.[0-9]&#43;</code></p>
<div class="ulist">
<ul>
<li>
<p>Pump version in <code>kaitaistruct.py</code> to <code>__version__ = '0.{XXX}'</code></p>
</li>
<li>
<p><code>git tag v0.{XXX}</code></p>
</li>
<li>
<p><code>git push origin master v0.{XXX}</code></p>
</li>
<li>
<p>Check <a href="https://test.pypi.org/project/kaitaistruct/" class="bare">https://test.pypi.org/project/kaitaistruct/</a> (the package distribution will be uploaded to TestPyPI first)</p>
</li>
<li>
<p>Approve the publishing CI workflow in <a href="https://github.com/kaitai-io/kaitai_struct_python_runtime/actions" class="bare">https://github.com/kaitai-io/kaitai_struct_python_runtime/actions</a></p>
</li>
<li>
<p>Wait until the timer expires (if something appears to be wrong, you can cancel the operation)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ruby">Ruby</h3>
<div class="ulist">
<ul>
<li>
<p>Pump version in <code>lib/kaitai/struct/struct.rb</code>, seek <code>VERSION =</code></p>
</li>
<li>
<p><code>export SOURCE_DATE_EPOCH=$(git log -1 --pretty=%ct)</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p><code>gem build kaitai-struct.gemspec</code></p>
</li>
<li>
<p>Test gem (i.e. by installing it to a live system)</p>
</li>
<li>
<p><code>gem push kaitai-struct-$VERSION.gem</code></p>
</li>
<li>
<p><code>git tag $VERSION</code></p>
</li>
<li>
<p><code>git push origin master $VERSION</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="csharp">C#</h3>
<div class="ulist">
<ul>
<li>
<p>Pump versions in <code>kaitai_struct_runtime_csharp.csproj</code>, commit and put <code>$VERSION</code> tag on it</p>
</li>
<li>
<p><code>CI=true dotnet pack -o .</code> &#8594; get resulting <code>.nupkg</code> file in the current directory</p>
</li>
<li>
<p>Create an API key on <a href="https://www.nuget.org/account/apikeys" class="bare">https://www.nuget.org/account/apikeys</a></p>
</li>
<li>
<p><code>dotnet nuget push *.nupkg -k &lt;API key&gt; -s https://api.nuget.org/v3/index.json</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_new_language">Adding new language</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Overall routine for adding new language is described in
<a href="new_language.html">Adding support for new target language</a>.</p>
</div>
<div class="paragraph">
<p>After addition, don&#8217;t forget to update lists of languages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/build.sbt - supportedLanguages</p>
</li>
<li>
<p><a href="https://github.com/kaitai-io/kaitai_struct" class="bare">https://github.com/kaitai-io/kaitai_struct</a> — project description</p>
</li>
<li>
<p><a href="https://github.com/kaitai-io/kaitai_struct_compiler" class="bare">https://github.com/kaitai-io/kaitai_struct_compiler</a> — project description</p>
</li>
<li>
<p><a href="//kaitai.io">http://kaitai.io</a> — everywhere</p>
</li>
<li>
<p><a href="https://bintray.com/kaitai-io/debian/kaitai-struct-compiler/view" class="bare">https://bintray.com/kaitai-io/debian/kaitai-struct-compiler/view</a> — package description</p>
</li>
<li>
<p><a href="https://twitter.com/kaitai_io" class="bare">https://twitter.com/kaitai_io</a> — profile</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://reproducible-builds.org/docs/source-date-epoch/#git" class="bare">https://reproducible-builds.org/docs/source-date-epoch/#git</a>
</div>
</div>
    <div id="footer">
            &copy; 2015&ndash;2025 Kaitai Project
    </div>
    <script src="js/jquery-1.12.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
<script src="js/asciidoctor-tabs.js"></script>
</body>
</html>